<!-- LTA List Component -->
<div class="lta-list-container">
  
  <!-- Header -->
  <div class="list-header">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="h4 mb-1">Gestion des LTA</h2>
        <p class="text-muted mb-0">Gérer toutes les expéditions de fret</p>
      </div>
      <div>
        <button 
          class="btn btn-primary me-2" 
          (click)="onCreateLTA()">
          <i class="bi bi-plus-circle me-1"></i>
          Nouvelle LTA
        </button>
        <button 
          class="btn btn-outline-secondary" 
          (click)="refreshData()">
          <i class="bi bi-arrow-clockwise me-1"></i>
          Actualiser
        </button>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="card filter-card mb-4">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <i class="bi bi-funnel me-2"></i>
        Filtres
      </h5>
    </div>
    <div class="card-body">
      <form [formGroup]="filterForm" class="filter-form">
        <div class="row g-3">
          
          <!-- Search -->
          <div class="col-12 col-md-4">
            <div class="form-group">
              <label for="search" class="form-label">Recherche</label>
              <div class="input-group">
                <input 
                  type="text"
                  id="search"
                  class="form-control" 
                  formControlName="search" 
                  placeholder="Numéro LTA, expéditeur, destinataire...">
                <span class="input-group-text">
                  <i class="bi bi-search"></i>
                </span>
              </div>
            </div>
          </div>

          <!-- Status Filter -->
          <div class="col-12 col-md-2">
            <div class="form-group">
              <label for="status" class="form-label">Statut</label>
              <select 
                id="status"
                class="form-select" 
                formControlName="status">
                <option value="">Tous les statuts</option>
                <option *ngFor="let status of statusOptions" [value]="status">
                  {{ getStatusLabel(status) }}
                </option>
              </select>
            </div>
          </div>

          <!-- Payment Mode Filter -->
          <div class="col-12 col-md-2">
            <div class="form-group">
              <label for="paymentMode" class="form-label">Mode de paiement</label>
              <select 
                id="paymentMode"
                class="form-select" 
                formControlName="paymentMode">
                <option value="">Tous les modes</option>
                <option *ngFor="let mode of paymentModeOptions" [value]="mode">
                  {{ getPaymentModeLabel(mode) }}
                </option>
              </select>
            </div>
          </div>

          <!-- Date From -->
          <div class="col-12 col-md-2">
            <div class="form-group">
              <label for="dateFrom" class="form-label">Date de début</label>
              <input 
                type="date"
                id="dateFrom"
                class="form-control" 
                formControlName="dateFrom">
            </div>
          </div>

          <!-- Date To -->
          <div class="col-12 col-md-2">
            <div class="form-group">
              <label for="dateTo" class="form-label">Date de fin</label>
              <input 
                type="date"
                id="dateTo"
                class="form-control" 
                formControlName="dateTo">
            </div>
          </div>

        </div>

        <!-- Filter Actions -->
        <div class="row mt-3">
          <div class="col-12">
            <button 
              type="button"
              class="btn btn-outline-secondary"
              (click)="clearFilters()">
              <i class="bi bi-x-circle me-1"></i>
              Effacer les filtres
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary mb-3" *ngIf="!loading">
    <div class="d-flex justify-content-between align-items-center">
      <span class="text-muted">
        Affichage {{ dataSource.length }} sur {{ totalElements }} LTA
      </span>
      <div class="pagination-info text-muted">
        Page {{ pageIndex + 1 }} sur {{ totalPages }}
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="card" *ngIf="loading">
    <div class="card-body text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="mt-3 text-muted">Chargement des LTA...</p>
    </div>
  </div>

  <!-- Data Table -->
  <div class="card" *ngIf="!loading">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col">Numéro LTA</th>
              <th scope="col">Origine</th>
              <th scope="col">Destination</th>
              <th scope="col">Expéditeur</th>
              <th scope="col">Destinataire</th>
              <th scope="col">Poids (kg)</th>
              <th scope="col">Statut</th>
              <th scope="col">Mode de paiement</th>
              <th scope="col">Coût ($)</th>
              <th scope="col">Date de création</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lta of dataSource; trackBy: trackByFn" 
                (click)="viewDetail(lta)" 
                style="cursor: pointer;">
              <td>
                <strong>{{ lta.ltaNumber }}</strong>
              </td>
              <td>
                <span class="badge bg-light text-dark">
                  {{ lta.originCity.iataCode || 'N/A' }}
                </span>
                <br>
                <small class="text-muted">
                  {{ lta.originCity.name || 'N/A' }}
                </small>
              </td>
              <td>
                <span class="badge bg-light text-dark">
                  {{ lta.destinationCity.iataCode || 'N/A' }}
                </span>
                <br>
                <small class="text-muted">
                  {{ lta.destinationCity.name || 'N/A' }}
                </small>
              </td>
              <td>
                {{ lta.shipperName || 'N/A' }}
              </td>
              <td>
                {{ lta.consigneeName || 'N/A' }}
              </td>
              <td>{{ lta.totalWeight }} kg</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(lta.status)">
                  {{ getStatusLabel(lta.status) }}
                </span>
              </td>
              <td>
                <span class="badge bg-info text-white">
                  {{ getPaymentModeLabel(lta.paymentMode) }}
                </span>
              </td>
              <td>
                <strong class="text-success">
                  ${{ lta.calculatedCost || 0 | number:'1.2-2' }}
                </strong>
                <small class="text-muted d-block" *ngIf="!lta.calculatedCost">
                  (Non calculé)
                </small>
              </td>
              <td>{{ lta.createdAt | date:'short' }}</td>
              <td>
                <div class="btn-group btn-group-sm" role="group">
                  <button 
                    type="button"
                    class="btn btn-outline-primary"
                    (click)="viewDetail(lta); $event.stopPropagation()"
                    title="Voir les détails">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button 
                    type="button"
                    class="btn btn-outline-info"
                    (click)="printLTA(lta); $event.stopPropagation()"
                    title="Imprimer">
                    <i class="bi bi-printer"></i>
                  </button>
                  <button 
                    type="button"
                    class="btn btn-outline-success"
                    (click)="downloadPDF(lta); $event.stopPropagation()"
                    title="Télécharger PDF">
                    <i class="bi bi-file-earmark-pdf"></i>
                  </button>
                  <button 
                    type="button"
                    class="btn btn-outline-secondary"
                    (click)="editLTA(lta); $event.stopPropagation()"
                    title="Modifier">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button 
                    type="button"
                    class="btn btn-outline-danger"
                    (click)="deleteLTA(lta); $event.stopPropagation()"
                    title="Supprimer">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pagination -->
    <div class="card-footer" *ngIf="totalElements > pageSize">
      <nav aria-label="Pagination LTA">
        <div class="d-flex justify-content-between align-items-center">
          <div class="pagination-info">
            <span class="text-muted">
              Affichage {{ (pageIndex * pageSize) + 1 }} à 
              {{ Math.min((pageIndex + 1) * pageSize, totalElements) }} sur 
              {{ totalElements }} entrées
            </span>
          </div>
          <div class="pagination-controls">
            <div class="btn-group" role="group">
              <button 
                type="button"
                class="btn btn-outline-secondary"
                [disabled]="pageIndex === 0"
                (click)="onPageChange(pageIndex - 1)">
                <i class="bi bi-chevron-left"></i>
                Précédent
              </button>
              <button 
                type="button"
                class="btn btn-outline-secondary"
                [disabled]="pageIndex >= totalPages - 1"
                (click)="onPageChange(pageIndex + 1)">
                Suivant
                <i class="bi bi-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </div>

  <!-- Empty State -->
  <div class="card" *ngIf="!loading && dataSource.length === 0">
    <div class="card-body text-center py-5">
      <i class="bi bi-inbox display-4 text-muted"></i>
      <h5 class="mt-3 text-muted">Aucune LTA trouvée</h5>
      <p class="text-muted">Aucune LTA ne correspond à vos filtres actuels. Essayez d'ajuster vos critères de recherche ou créez une nouvelle LTA.</p>
      <button 
        type="button"
        class="btn btn-primary me-2"
        (click)="onCreateLTA()">
        <i class="bi bi-plus-circle me-1"></i>
        Créer une LTA
      </button>
      <button 
        type="button"
        class="btn btn-outline-secondary"
        (click)="clearFilters()">
        <i class="bi bi-x-circle me-1"></i>
        Effacer les filtres
      </button>
    </div>
  </div>

</div>
