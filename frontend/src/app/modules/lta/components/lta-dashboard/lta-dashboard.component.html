<!-- LTA Dashboard -->
<div class="lta-dashboard py-4">
  <div class="container-fluid">

    <!-- Header avec FlexLayout -->
    <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="16px" fxLayoutAlign="center center" class="mb-4">
      <div fxFlex="auto" class="text-center">
        <h1 class="h3 mb-1 fw-bold">Gestion des LTA</h1>
        <small class="text-muted">Tableau de bord du système de gestion de fret</small>
      </div>
      <div fxLayout="row" fxLayout.xs="column" fxLayoutGap="8px" fxFlex="none" class="justify-content-center">
        <button type="button" class="btn btn-primary" (click)="onCreateLTA()">
          <i class="bi bi-plus-circle me-1"></i> Nouvelle LTA
        </button>
        <button type="button" class="btn btn-outline-primary" (click)="onViewAllLTAs()">
          <i class="bi bi-list me-1"></i> Voir tout
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="refreshStats()">
          <i class="bi bi-arrow-clockwise me-1"></i> Actualiser
        </button>
      </div>
    </div>

    <!-- Dashboard Content (only show when on dashboard route) -->
    <ng-container *ngIf="showDashboardContent">
      <!-- Stats Cards avec gradients modernes -->
      <div class="row g-4 mb-4" *ngIf="!loading && stats">
        <!-- Card Brouillon -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12">
          <div class="card gradient-card gradient-draft h-100">
            <div class="card-body text-white">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="card-subtitle mb-2 text-white-50">Brouillon</h6>
                  <h2 class="card-title mb-0 fw-bold">{{ stats.pendingCount }}</h2>
                  <p class="card-text mt-2 mb-0">
                    <small class="text-white-75">LTA en préparation</small>
                  </p>
                </div>
                <div class="card-icon">
                  <i class="bi bi-file-earmark-text fs-1 opacity-75"></i>
                </div>
              </div>
              <div class="progress mt-3" style="height: 4px;">
                <div class="progress-bar bg-white" role="progressbar" style="width: 65%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Confirmé -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12">
          <div class="card gradient-card gradient-confirmed h-100">
            <div class="card-body text-white">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="card-subtitle mb-2 text-white-50">Confirmé</h6>
                  <h2 class="card-title mb-0 fw-bold">{{ stats.confirmedCount }}</h2>
                  <p class="card-text mt-2 mb-0">
                    <small class="text-white-75">Prêt pour expédition</small>
                  </p>
                </div>
                <div class="card-icon">
                  <i class="bi bi-check-circle fs-1 opacity-75"></i>
                </div>
              </div>
              <div class="progress mt-3" style="height: 4px;">
                <div class="progress-bar bg-white" role="progressbar" style="width: 80%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card En Transit -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12">
          <div class="card gradient-card gradient-transit h-100">
            <div class="card-body text-white">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="card-subtitle mb-2 text-white-50">En Transit</h6>
                  <h2 class="card-title mb-0 fw-bold">{{ stats.inTransitCount }}</h2>
                  <p class="card-text mt-2 mb-0">
                    <small class="text-white-75">En cours de livraison</small>
                  </p>
                </div>
                <div class="card-icon">
                  <i class="bi bi-truck fs-1 opacity-75"></i>
                </div>
              </div>
              <div class="progress mt-3" style="height: 4px;">
                <div class="progress-bar bg-white" role="progressbar" style="width: 45%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Card Livré -->
        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-12">
          <div class="card gradient-card gradient-delivered h-100">
            <div class="card-body text-white">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="card-subtitle mb-2 text-white-50">Livré</h6>
                  <h2 class="card-title mb-0 fw-bold">{{ stats.deliveredCount }}</h2>
                  <p class="card-text mt-2 mb-0">
                    <small class="text-white-75">Expéditions terminées</small>
                  </p>
                </div>
                <div class="card-icon">
                  <i class="bi bi-check-all fs-1 opacity-75"></i>
                </div>
              </div>
              <div class="progress mt-3" style="height: 4px;">
                <div class="progress-bar bg-white" role="progressbar" style="width: 100%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Stats -->
      <div class="text-center py-4" *ngIf="loading">
        <div class="spinner-border text-primary spinner-border-sm"></div>
        <p class="mt-2 text-muted">Chargement des statistiques...</p>
      </div>

      <!-- Recent LTAs -->
      <div class="card shadow-sm mb-4">
        <div class="card-header" fxLayout="row" fxLayoutAlign="space-between center">
          <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i> LTA Récentes</h5>
          <button type="button" class="btn btn-sm btn-outline-primary" (click)="onViewAllLTAs()">Voir tout</button>
        </div>
        <div class="card-body p-0">

          <!-- Loading State -->
          <div class="text-center py-4" *ngIf="loadingRecent">
            <div class="spinner-border text-primary spinner-border-sm"></div>
            <p class="mt-2 text-muted">Chargement des LTA récentes...</p>
          </div>

          <!-- Table -->
          <div class="table-responsive" *ngIf="!loadingRecent && recentLTAs.length > 0">
            <table class="table table-hover table-striped align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Numéro LTA</th>
                  <th>Route</th>
                  <th>Statut</th>
                  <th class="d-none d-md-table-cell">Poids</th>
                  <th class="d-none d-md-table-cell">Coût</th>
                  <th>Créée</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let lta of recentLTAs" (click)="onViewLTA(lta.id)" style="cursor:pointer;">
                  <td><strong>{{ lta.ltaNumber }}</strong></td>
                  <td>
                    <span class="badge bg-light text-dark">
                      {{ lta.originCity?.iataCode || lta.origin || 'N/A' }} → {{ lta.destinationCity?.iataCode || lta.destination || 'N/A' }}
                    </span>
                  </td>
                  <td>
                    <span class="badge"
                      [ngClass]="{
                        'bg-secondary': lta.status === 'DRAFT',
                        'bg-primary': lta.status === 'CONFIRMED',
                        'bg-warning': lta.status === 'IN_TRANSIT',
                        'bg-success': lta.status === 'DELIVERED',
                        'bg-danger': lta.status === 'CANCELLED'
                      }">
                      {{ lta.status }}
                    </span>
                  </td>
                  <td class="d-none d-md-table-cell">{{ lta.totalWeight }} kg</td>
                  <td class="d-none d-md-table-cell">€{{ lta.calculatedCost | number:'1.2-2' }}</td>
                  <td>{{ lta.createdAt | date:'short' }}</td>
                  <td>
                    <button type="button" class="btn btn-sm btn-outline-primary"
                            (click)="onViewLTA(lta.id); $event.stopPropagation()">
                      <i class="bi bi-eye"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Empty State avec FlexLayout -->
          <div fxLayout="column" fxLayoutAlign="center center" class="py-4" *ngIf="!loadingRecent && recentLTAs.length === 0">
            <i class="bi bi-inbox display-4 text-muted"></i>
            <h5 class="mt-3 text-muted">Aucune LTA trouvée</h5>
            <p class="text-muted">Créez votre première LTA pour commencer.</p>
            <button type="button" class="btn btn-primary" (click)="onCreateLTA()">
              <i class="bi bi-plus-circle me-1"></i> Créer une LTA
            </button>
          </div>

        </div>
      </div>
    </ng-container>

    <!-- Router Outlet for Child Components -->
    <router-outlet></router-outlet>

  </div>
</div>
