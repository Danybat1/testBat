<!-- Loading and Error States -->
<div *ngIf="isLoading" class="loading-overlay">
  <div class="loading-spinner">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Chargement en cours...</p>
  </div>
</div>

<div *ngIf="error" class="error-message">
  <i class="fas fa-exclamation-triangle"></i>
  <p>{{ error }}</p>
  <button class="btn btn-secondary" (click)="error = null">Fermer</button>
</div>

<!-- Page Header with Actions -->
<div class="page-header mb-4">
  <div class="d-flex justify-content-between align-items-center">
    <div>
      <h2><i class="fas fa-file-alt"></i> Gestion des Manifestes</h2>
      <p class="text-muted">Liste et consultation des manifestes d'expédition</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-success me-2" (click)="onCreateNewManifest()">
        <i class="fas fa-plus"></i> Nouveau Manifeste
      </button>
      <button class="btn btn-outline-primary" (click)="onRefresh()">
        <i class="fas fa-sync-alt"></i> Actualiser
      </button>
    </div>
  </div>
</div>

<!-- Filters and Search -->
<div class="filters-section mb-4">
  <div class="row">
    <div class="col-md-4">
      <div class="form-group">
        <label>Rechercher</label>
        <input type="text" class="form-control" placeholder="N° Manifeste, Proforma..." 
               [(ngModel)]="searchTerm" (input)="onSearch()">
      </div>
    </div>
    <div class="col-md-3">
      <div class="form-group">
        <label>Statut</label>
        <select class="form-control" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
          <option value="">Tous les statuts</option>
          <option value="DRAFT">Brouillon</option>
          <option value="CONFIRMED">Confirmé</option>
          <option value="IN_TRANSIT">En transit</option>
          <option value="DELIVERED">Livré</option>
        </select>
      </div>
    </div>
    <div class="col-md-3">
      <div class="form-group">
        <label>Mode de transport</label>
        <select class="form-control" [(ngModel)]="selectedTransportMode" (change)="onFilterChange()">
          <option value="">Tous les modes</option>
          <option value="ROAD">Routier</option>
          <option value="AIR">Aérien</option>
          <option value="SEA">Maritime</option>
          <option value="RAIL">Ferroviaire</option>
          <option value="MULTIMODAL">Multimodal</option>
        </select>
      </div>
    </div>
    <div class="col-md-2">
      <div class="form-group">
        <label>&nbsp;</label>
        <button class="btn btn-outline-secondary form-control" (click)="onClearFilters()">
          <i class="fas fa-times"></i> Effacer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Manifests List -->
<div class="manifests-list">
  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>N° Manifeste</th>
          <th>N° Proforma</th>
          <th>Date de création</th>
          <th>Mode de transport</th>
          <th>Expéditeur</th>
          <th>Destinataire</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let manifest of filteredManifests; let i = index">
          <td>
            <strong class="text-primary">{{ manifest.manifestNumber }}</strong>
          </td>
          <td>{{ manifest.proformaNumber }}</td>
          <td>{{ formatDate(manifest.createdDate) }}</td>
          <td>
            <span class="badge badge-transport" [class]="getTransportModeClass(manifest.transportMode)">
              {{ getTransportModeLabel(manifest.transportMode) }}
            </span>
          </td>
          <td>{{ getShipperName(manifest) }}</td>
          <td>{{ getConsigneeName(manifest) }}</td>
          <td>
            <span class="badge" [class]="getStatusClass(manifest.status)">
              {{ getStatusLabel(manifest.status) }}
            </span>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button class="btn btn-sm btn-outline-primary" 
                      (click)="onViewManifest(manifest)"
                      title="Consulter">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-outline-success" 
                      (click)="onPrintPDF(manifest)"
                      title="Imprimer PDF">
                <i class="fas fa-file-pdf"></i>
              </button>
              <button class="btn btn-sm btn-outline-info" 
                      (click)="onPrintWord(manifest)"
                      title="Imprimer Word">
                <i class="fas fa-file-word"></i>
              </button>
              <button class="btn btn-sm btn-outline-warning" 
                      (click)="onEditManifest(manifest)"
                      title="Modifier"
                      *ngIf="canEdit(manifest)">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredManifests.length === 0">
          <td colspan="8" class="text-center text-muted py-4">
            <i class="fas fa-inbox fa-2x mb-2"></i>
            <p>Aucun manifeste trouvé</p>
            <button class="btn btn-primary" (click)="onCreateNewManifest()">
              <i class="fas fa-plus"></i> Créer le premier manifeste
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Pagination -->
<div class="pagination-section" *ngIf="totalPages > 1">
  <nav aria-label="Navigation des pages">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="onPageChange(currentPage - 1)">Précédent</a>
      </li>
      <li class="page-item" *ngFor="let page of getPageNumbers()" 
          [class.active]="page === currentPage">
        <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="onPageChange(currentPage + 1)">Suivant</a>
      </li>
    </ul>
  </nav>
</div>
